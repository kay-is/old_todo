<!DOCTYPE HTML>
<meta charset="utf-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<title>Todo</title>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.0/superhero/bootstrap.min.css" type="text/css" media="all" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css" type="text/css" media="all" />

<style>
  .container-fluid {
    margin-top: 50px;
    margin-right: auto;
    margin-left: auto;
    max-width: 750px;
  }
  .nav li {
    display:table-cell !important;
  }
  .list-group-item a i {
    margin-left: 20px;
    margin-top: -5px;
  }
  .list-group-item > p {
    width: 65%;
  }
  .list-group-item {
    margin-bottom: 2px;
  }
  label, h1, h2, h3, h4 {
    font-weight: bolder;
  }
  .badge {
    background-color: #2b3e50;
  }
  a {
    cursor: pointer;
  }
  .form-control {
    font-size: 17px;
  }
</style>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/emblem/0.3.18/emblem.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ember.js/1.9.0-beta.1/ember.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ember-data.js/1.0.0-beta.11/ember-data.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ember-localstorage-adapter/0.3.1/localstorage_adapter.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/livescript/1.3.1/livescript-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>


<script type="text/x-emblem" data-template-name="application">
  .container-fluid
    = outlet
</script>

<script type="text/x-emblem" data-template-name="newtask">
  h1 New Task
  form submit="create"
    .form-group
      label Title
      = input class="form-control" valueBinding="title" required="required" autofocus="autofocus"
    .form-group
      label Project
      = input class="form-control" valueBinding="project"
    .form-group
      label Description
      = textarea class="form-control" valueBinding="description"
    = input class="btn btn-primary btn-lg btn-block" type="submit" value="Create"
    link-to "index" class="btn btn-default btn-lg btn-block" | Cancel
</script>

<script type="text/x-emblem" data-template-name="todolist">
  link-to "newtask" class="btn btn-primary btn-lg btn-block" | Create New Task
  br
  br
  ul.nav.nav-tabs.nav-justified
    tab-li
      link-to 'todolist' 'inbox'
        i.fa.fa-inbox.fa-lg
        span Inbox
    tab-li
      link-to 'todolist' 'next'
        i.fa.fa-exclamation-circle.fa-lg.text-primary
        span Next Actions
    tab-li
      link-to 'todolist' 'waiting'
        i.fa.fa-clock-o.fa-lg.text-warning
        span Waiting For
    tab-li
      link-to 'todolist' 'maybe'
        i.fa.fa-question-circle.fa-lg.text-info
        span Maybe
    tab-li
      link-to 'todolist' 'done'
        i.fa.fa-check-circle.fa-lg.text-success
        span Done

  ul.list-group
    each
      li.list-group-item id=id
        h4.list-group-item-heading
          = title
          if project
            span.badge
              = project
  
          if inbox
            a.pull-right.text-info click="move 'maybe'"
              i.fa.fa-question-circle.fa-2x
            a.pull-right.text-warning click="move 'waiting'"
              i.fa.fa-clock-o.fa-2x
            a.pull-right.text-primary click="move 'next'"
              i.fa.fa-exclamation-circle.fa-2x
  
          if next
            a.pull-right.text-success click="move 'done'"
              i.fa.fa-check-circle.fa-2x
            a.pull-right.text-info click="move 'maybe'"
              i.fa.fa-question-circle.fa-2x
            a.pull-right text-warning click="move 'waiting'"
              i.fa.fa-clock-o.fa-2x
  
          if waiting
            a.pull-right.text-success click="move 'done'"
              i.fa.fa-check-circle.fa-2x
            a.pull-right.text-info click="move 'maybe'"
              i.fa.fa-question-circle.fa-2x
            a.pull-right.text-primary click="move 'next'"
              i.fa.fa-exclamation-circle.fa-2x
  
          if maybe
            a.pull-right.text-danger click="move 'out'"
              i.fa.fa-times-circle.fa-2x
            a.pull-right.text-warning click="move 'waiting'"
              i.fa.fa-clock-o.fa-2x
            a.pull-right.text-primary click="move 'next'"
              i.fa.fa-exclamation-circle.fa-2x
  
          if done
            a.pull-right.text-danger click="move 'out'"
              i.fa.fa-times-circle.fa-2x
            a.pull-right.text-info click="move 'maybe'"
              i.fa.fa-question-circle.fa-2x
            a.pull-right.text-warning click="move 'waiting'"
              i.fa.fa-clock-o.fa-2x
            a.pull-right.text-primary click="move 'next'"
              i.fa.fa-exclamation-circle.fa-2x
        p.list-group-item-text
          = markdown description
    else
      li.list-group-item
        h4.list-group-item-heading
          List Empty
</script>

<script type="text/ls">
App = window.App = Em.Application.create!

App.ApplicationSerializer = DS.LSSerializer.extend!
App.ApplicationAdapter = DS.LSAdapter.extend 'namespace':'todo'

App.Router.map !->
  @resource \todolist path:'/:list'
  @route \newtask path:'/new'

App.IndexRoute = Em.Route.extend do
  before-model:->
    @transition-to \todolist \inbox

App.TodolistRoute = Em.Route.extend do
  model:(params)->
    @store.filter \todo, 'list':params.list, -> (it.get \list) is params.list

App.TodolistController = Em.ArrayController.extend do
  actions:move:(target-list, record)->
    if target-list is \out
      record.delete-record!
      record.save!
    else
      record.set \list target-list .save!

App.NewtaskController = Em.Controller.extend do
  list:\inbox
  actions:create:->
    input = @get-properties <[title project list description dueBy]>
    record = @store.create-record \todo input
    record.save!

    @set \title ''
    @set \project ''
    @set \description ''
  
    @transition-to \index

App.Todo = DS.Model.extend do
  title: DS.attr \string
  description: DS.attr \string
  project: DS.attr \string
  list: DS.attr \string
  inbox:(-> (@get \list) is \inbox ).property \list
  next:(-> (@get \list) is \next ).property \list
  waiting:(-> (@get \list) is \waiting ).property \list
  maybe:(-> (@get \list) is \maybe ).property \list
  done:(-> (@get \list) is \done ).property \list

App.TabLiComponent = Em.Component.extend do
  tag-name:\li
  class-name-bindings:<[active]>
  active:(->
    @get \childViews .any-by \active
  ).property \childViews.@each.active
  
Em.Handlebars.helper \markdown ->
 if it
   new Em.Handlebars.SafeString marked it

</script>
<script>require("LiveScript").go()</script>
<body ontouchstart=""></body>